<!DOCTYPE html>
<html>
  <head>
    <title>Fleuréa Dispatcher | Portail administration</title>
    <link rel="shortcut icon" href="https://res.cloudinary.com/devee5rfe/image/upload/v1754320567/OIP_lz4npc.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  </head>
  <body>
    <div id="toast-container"></div>
    <div id="lightbox">
      <div class="lightbox-content w3-center">
        <span id="close-btn">&times;</span>
        <div class="circleB" style="top:50%; left:50%; transform:translate(-50%,-50%)">
          <img id="lightImg" src="" alt="Profil">
        </div>
        <h2 id="lightH2"></h2>
        <p id="lightP"></p>
        <button onclick="localStorage.removeItem('offtoken'); sessionStorage.removeItem('session_id'); start();">Se déconnecter</button>
      </div>
    </div>
     <div id="lightboxB">
      <div class="lightbox-content w3-center">
        <span id="close-btnB">&times;</span>
        <h2 id="lightH2B"></h2>
        <p id="lightPB"></p>
        <i id="lightPB2"></i>
        <div style="display:none;" id="editeurLightBenne">
          <div class="w3-center">
          <i>Sélectionnez un paramètre puis modifiez-le...</i>
            <select id="modifierSelecter"></select>
            <input id="inpSelecter" type="text" name="valueSelecter">
            <button onclick="logModification()">Enregistrer</button>
          </div>
        </div>
        <button onclick="if (document.getElementById('editeurLightBenne').style.display == 'none') {document.getElementById('editeurLightBenne').style.display = 'flex'} else {document.getElementById('editeurLightBenne').style.display = 'none'}">Éditer</button>
        <button onclick="deleteBenne(numon)">Supprimer</button>
      </div>
    </div>
   <div class="head" id="head">
     <div id="heure"><p id="time">N/A</p></div>
     <div id="portal"><p>Portail Administration</p></div>
       <button onclick="document.getElementById('map').style.display='flex';document.getElementById('admin').style.display='none'; resizeMap();" id="visuBtn">Voir la carte</button>
       <button onclick="document.getElementById('map').style.display='none';document.getElementById('admin').style.display='flex';" id="adminBtn">Administration</button>
     <div id="logo_eurea">
       <img src="https://res.cloudinary.com/devee5rfe/image/upload/v1754320567/OIP_lz4npc.jpg" onclick="window.location.href = 'https://www.groupe-eurea.com/';" alt="Logo Euréa">
       </div>
   <div id="compte">
      <div class="circle"> 
      <img id="myPict" src="" alt="Icône du propriétaire du compte">
      </div>
     <p id="myName">ADMIN</p>
   </div>
   </div>

    <div id="map">
      <div id="panel"></div>
      <div id="view">
        <div id="mapA">
          
        </div>
      </div>
    </div>
    <div style="display:none" id="admin">
      <div id="selecter">
        <button onclick="document.getElementById('bennesSearch').style.display='flex';document.getElementById('comptesSearch').style.display='none';document.getElementById('clientsSearch').style.display='none'; putBennes('no'); document.getElementById('cerealesSearch').style.display='none';document.getElementById('infosSearch').style.display='none';" id="btnBennes">Bennes</button>
        <button onclick="document.getElementById('bennesSearch').style.display='none';document.getElementById('comptesSearch').style.display='flex';document.getElementById('clientsSearch').style.display='none'; document.getElementById('cerealesSearch').style.display='none';document.getElementById('infosSearch').style.display='none';" id="btnComptes">Comptes</button>
        <button onclick="document.getElementById('bennesSearch').style.display='none';document.getElementById('comptesSearch').style.display='none';document.getElementById('clientsSearch').style.display='flex'; document.getElementById('cerealesSearch').style.display='none';document.getElementById('infosSearch').style.display='none';" id="btnClients">Clients</button>
        <button onclick="document.getElementById('bennesSearch').style.display='none';document.getElementById('comptesSearch').style.display='none';document.getElementById('clientsSearch').style.display='none'; document.getElementById('cerealesSearch').style.display='flex';document.getElementById('infosSearch').style.display='none';" id="btnCereales">Céréales</button>
        <button onclick="document.getElementById('bennesSearch').style.display='none';document.getElementById('comptesSearch').style.display='none';document.getElementById('clientsSearch').style.display='none'; document.getElementById('cerealesSearch').style.display='none';document.getElementById('infosSearch').style.display='flex';" id="btnInfos">Paramètres</button>
      </div>
      <div id="bennesSearch">
              <div id="searcherBenne">
                <input class='input_search' type="text" id="text_searcherBenne" placeholder="Recherchez une benne ici...">
                <button id="filtrerBennes" onclick="putBennes(document.getElementById('text_searcherBenne').value);">Filtrer</button>
                <button onclick="putBennes('no'); document.getElementById('text_searcherBenne').value = '';">Réinitialiser</button>
                <progress id="benne_progress" value="0" max="100"></progress>
              </div>
        <div class="scroll-container" id="bennesScroller">
          <div id="bennesContent"></div> <!-- C'est ici qu'on va insérer les bennes. Il faut savoir qu'on doit récupérer les bennes sous forme de liste, les insérer et quand on fait une recherche, on refait le protocole d'insertion sans le filtre-->
        </div>
        <form id="createBenne">
          <input class="input_search" type="text" name="num" placeholder="N° de la Benne">
          <input class="input_search" type="number" name="volume" placeholder="Capacité (T)">
          <button type="submit">Créer une benne</button>
        </form>
      </div>
      <div style="display:none" id="comptesSearch">
        <div class="scroll-container" id="comptesScroller">
          <div id="comptesContent"></div> <!-- C'est ici qu'on va insérer les comptes. Il faut savoir qu'on doit récupérer les bennes sous forme de liste, les insérer et quand on fait une recherche, on refait le protocole d'insertion sans le filtre-->
        </div>
      </div>
      <div style="display:none" id="clientsSearch">
        <div class="scroll-container" id="clientsScroller">
          <div id="clientsContent"></div> <!-- C'est ici qu'on va insérer les clients. Il faut savoir qu'on doit récupérer les bennes sous forme de liste, les insérer et quand on fait une recherche, on refait le protocole d'insertion sans le filtre-->
        </div>
      </div>
      <div style="display:none" id="cerealesSearch">
        <div class="scroll-container" id="cerealesScroller">
          <div id="cerealesContent"></div> <!-- C'est ici qu'on va insérer les céréales. Il faut savoir qu'on doit récupérer les bennes sous forme de liste, les insérer et quand on fait une recherche, on refait le protocole d'insertion sans le filtre-->
        </div>
      </div>
      <div style="display:none" id="infosSearch">
        <div class="scroll-container" id="infosScroller">
          <div id="infosContent"></div> <!-- C'est ici qu'on va insérer les informations. Il faut savoir qu'on doit récupérer les bennes sous forme de liste, les insérer et quand on fait une recherche, on refait le protocole d'insertion sans le filtre-->
        </div>
      </div>
    </div>
    <style>
      .scroll-container {
        height:90%;
        width:100%;
        overflow-y:auto;
        overflow-x:auto;
        padding:1vw;
        background:grey;
      }
      #map {
        position:fixed;
        top:10vh;
        height:90vh;
        width:100vw;
        display:flex;
        flex-direction:row;
      }
      #admin {
        position:fixed;
        top:10vh;
        height:90vh;
        width:100vw;
        display:flex;
        flex-direction:column;
      }
      .input_search {
        height:2vh;
        width:25vh;
      }
      #bennesSearch, #comptesSearch, #clientsSearch, #cerealesSearch, #infosSearch {
        top:15vh;
        height:85vh;
        flex-direction:column;
      }
      #selecter, #searcherBenne, #createBenne {
        width:100%;
        height:5%;
        background:linear-gradient(90deg, black, grey);
        align-items:center; /* We center everything in height */
        justify-content:space-between; /* Distribue l'espace horizontalement */
        display:flex;
        padding: 0 1rem;
        box-sizing: border-box;
      }
      #view {
        flex:1;
        height:100%;
        background:lightgray;
      }
       #panel {
        width:20%;
        height:100%;
        background:grey;
      }
      #mapA {
        height:100%;
        width:100%;
        margin:0;
        padding:0;
      }

       .leaflet-control-layers {
      z-index:1001;
    }
      
      body {
          margin: 0;
          padding:1rem;
          height: 100vh;
          width: 100vw;
          display:flex;
          justify-content:center; /* aligné à l'horizontal */
          align-items:center; /* aligné en vertical */
          background: linear-gradient(135deg, blue, yellow);
          font-family: Arial, sans-serif;
           box-sizing:border-box; 
      }
      .form-container {
          background: white;
          padding: 2rem;
          border-radius: 1rem;
          width:100%;
          height:auto;
          max-width:400px;
          box-shadow: 0 8px 20px rgba(0,0,0,0.7);
         box-sizing:border-box;
      }
      input {
        width: 100%;
        padding: 0.75rem;
       /* margin-bottom: 1rem; */
        border: 1px solid #ccc;
        border-radius: 0.5rem;
        font-size: 1rem;
        box-sizing:border-box; 
      }
      button {
        
        
        background-color:blue;
        color:white;
       
        border: none;
        border-radius: 0.5rem;
        font-size: 1rem;
        cursor:pointer;
        transition:background 0.3s ease;
       box-sizing:border-box;
      }
      button:hover {
        background-color:red;
      }
      .img {
        max-width:80%;
        height:auto;
       box-sizing:border-box;
        margin:0.5rem;
      }
      .head {
        background:linear-gradient(90deg, black, grey);
        display:flex;
        position:fixed; /* Fixed is better than absolute as it fix the position even when scolling */
        top:0;
        left:0; /* We'll take the left side as a spot better than the right one */
        width:100%;
        height:10vh;
        align-items:center; /* We center everything in height */
        justify-content:space-between; /* Distribue l'espace horizontalement */
        padding:0 1rem; /* Espace entre bordure et contenu */
        box-sizing:border-box;
        color:white;
        font-weight:bold; /* Police d'écriture en gras */
        z-index:1000;
      }
      .circle {
        width:5vh;
        height:5vh;
        border-radius:50%;
        overflow:hidden;
        position:relative;
      }

      .circleB {
        width:15vh;
        height:15vh;
        border-radius:50%;
        overflow:hidden;
        position:relative;
      }
       .circle img, .circleB img {
        width:100%;
        height:100%;
        object-fit:cover;
        position:absolute;
        top:50%;
        left:50%;
        transform: translate(-50%,-50%);
      }
      #heure, #portal, #logo_eurea, #compte, #visuBtn, #adminBtn {
        display:flex;
        align-items:center;
        white-space:nowrap; /* Forcer le texte à rester sur une seule ligne */
      }
  
      #logo_eurea img {
        height:6vh;
        cursor:pointer;
      }

      #compte p {
        margin:0;
        font-size:1rem;
        margin-left:2vh;
      }

      @media (max-width: 680px) { /* Ce qui se cache sur la version mobile */
         #heure, #portal, #logo_eurea {
           display:none;
         }
        button {
          font-size:0.75rem;
        } 
      }
    </style>
    <script>
const offset = -((new Date().getTimezoneOffset()) / 60);
      console.log(offset);
      
          async function start() {
      url = new URL(window.location.href);
      sessionId = await sessionStorage.getItem('session_id');
      if (!sessionId) {
        console.log("Not connected");
        window.location.href = `https://${url.hostname}`; 
      } else {
        if (await check(sessionId)) {
        console.log("Connected");
       await connectWebSocket();
          await getMe();
        } else {
        sessionStorage.removeItem('session_id');
        console.log("Not connected");
        window.location.href = `https://${url.hostname}`; 
        }
      }
      }
      
      start();

      
      async function check(id) {
        const answer = await fetcher('checksession',{'id':id},'POST','noauth');
        const bool = answer.value;
        console.warn(bool);
        if (bool) {
          console.warn("true");
          return true;
        } else {
          console.warn("false");
          return false;
        }
      }

      async function fetcher (endpoint, body, method, auth) {
        try {
        const response = await fetch(`https://${url.host}/${endpoint}`,{
          'method':method,
          'headers' : {
            'Content-Type':'application/json',
            'auth': auth
          }, 
          'body' : JSON.stringify(body)
        });
        const data = await response.json();
          return data;
        } catch (err) {return err;}
      }

      let socket;
      // Ici on gère la technologie websocket
      async function connectWebSocket() {
        if (socket && socket.readyState === WebSocket.OPEN) {
          return;
        }
        socket = new WebSocket (`wss://${url.host}?key=${sessionStorage.getItem('session_id')}&offset=${offset}`);
        socket.addEventListener('open', () => {
               // console.log("Connecté au serveur websocket !");
          socket.send(JSON.stringify({action:"SET", offset:offset}));
        });
        socket.addEventListener("message", (event) => {
        mes = JSON.parse(event.data);
        if (mes.action === 'time') {
          document.getElementById('time').textContent = mes.value;
        }
           if (mes.action === 'benstatus') {
          if (mes.who === sessionStorage.getItem('session_id')) {
            console.log(parseFloat(mes.value)*100);
            document.getElementById('benne_progress').value = parseFloat(mes.value)*100;
          }
        }
      });
      }

let mydatas = {};
let generalDatas;
      
      async function getMe() {
        const answer = await fetcher('getme',{'id':sessionStorage.getItem('session_id')},'POST',sessionStorage.getItem('session_id'));
        const icon = answer.icon;
        const first_name = answer.first_name;
        const name = answer.name;
        const role = answer.role;
        document.getElementById('myPict').src = icon;
        document.getElementById('myName').textContent = `${first_name} ${name}`;
        mydatas["icon"] = icon;
        mydatas["first_name"] = first_name;
        mydatas["name"] = name;
        mydatas["role"] = role;
        getGeneralDatas();
      }

       async function getGeneralDatas() {
        const answer = await fetcher('getgeneraldatas',{'id':sessionStorage.getItem('session_id')},'POST',sessionStorage.getItem('session_id'));
        generalDatas = answer;
        console.log(generalDatas);
      }
    </script>
    <style>
      #lightbox, #lightboxB {
        position:fixed;
        top:0;
        left:0;
        height:100vh;
        width:100vw;
        background:rgba(100,100,100,0.7);
        display:none;
        justify-content:center;
        align-items:center;
        z-index:1000;
      }
       .lightbox-content {
       background:white;
        padding:2em;
         border-radius:12px;
         text-align:center;
         max-width:400px;
         width:80%;
         position:relative;
         box-shadow: 0 0 15px rgba(0,0,0,0.3);
      }
      #close-btn, #close-btnB {
        position:absolute;
        top:10px;
        right:15px;
        font-size:1.8em;
        cursor:pointer;
        color:red;
      }
      .line {
        width:100%;
        height:10vh;
        display:flex;
        flex-direction:row;
        background:linear-gradient(135deg, white, blue);
        border: 1vh solid black;
        margin-top:1vh;
        align-items:center;
        justify-content: space-between;
        padding: 0.5rem;
      }
    </style>
     <script>
       const profilePic = document.getElementById('compte');
       const lightbox = document.getElementById('lightbox');
       const closeBtn = document.getElementById('close-btn');
       document.addEventListener('DOMContentLoaded', () => {
       profilePic.addEventListener('click', () => {
         lightbox.style.display = 'flex';
         document.getElementById('lightH2').textContent = mydatas["first_name"] + " " + mydatas["name"];
         document.getElementById('lightImg').src =  mydatas["icon"];
         document.getElementById('lightP').textContent =  mydatas["role"];
       });
        closeBtn.addEventListener('click', () => {
         lightbox.style.display = 'none';
       });
       lightbox.addEventListener('click', (e) => {
         if (e.target === lightbox) {
           lightbox.style.display = 'none';
         }
       });
       });
     </script>
    <script>
    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OSM' });
    const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: '© Esri' });
    const topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { attribution: 'Map data: © OpenStreetMap contributors, SRTM | Map style: © OpenTopoMap' });
    
    const baseMaps = {
  "OpenStreetMap": osm,
  "Satellite": satellite,
      "Topographie":topo
  };
    
    const map = L.map('mapA').setView([45.72191877191547, 4.227417998761897], 15);
    L.control.layers(baseMaps, null, {position:'bottomleft'}).addTo(map);
    osm.addTo(map);
      setTimeout(() => {
      map.invalidateSize();
      }, 300);

      async function getBennes() {
        return await fetcher('getbennes',{'id':sessionStorage.getItem('session_id')},'POST',sessionStorage.getItem('session_id'));
      }

      async function putBennes(filtre) {
        console.log("Appel d'un putBennes...");
        const bennes = await getBennes();
        console.log(bennes);
        let filtered = [];
        if (filtre !== 'no') {
        filtered = await filter(bennes, filtre);
        } else {
        filtered = bennes;
        }
        console.log("Le système a filtré la liste :");
        console.log(filtered);
        const bennesContainer = document.getElementById('bennesContent');
        bennesContainer.innerHTML = "";
        console.log("On va traiter l'ajout...");
        for (const ben of filtered) {
          console.log("Création d'une benne :", ben);
          const line = document.createElement('div');
          line.classList.add('line');
          line.id = `B${ben.id}`;
benDatas[ben.id] = ben;
       const lightbox = document.getElementById('lightboxB');
       const closeBtn = document.getElementById('close-btnB');
      console.log("LIGHTBOX");
      line.addEventListener('click', () => {
         lightbox.style.display = 'flex';
         document.getElementById('lightH2B').textContent = "Benne n°" + ben.id;
         document.getElementById('lightPB').textContent =  ben.volume + " T";
         popAdresse(ben.latitude, ben.longitude);
        numon = ben.id;
        console.log(numon);
        document.getElementById('editeurLightBenne').style.display == 'none';
        selecter.selectedIndex = 0;
         document.getElementById('inpSelecter').value = "";
       });
        closeBtn.addEventListener('click', () => {
         lightbox.style.display = 'none';
        document.getElementById('editeurLightBenne').style.display = 'none';
        selecter.selectedIndex = 0;
         document.getElementById('inpSelecter').value = "";
       });
       lightbox.addEventListener('click', (e) => {
         if (e.target === lightbox) {
           lightbox.style.display = 'none';
             document.getElementById('editeurLightBenne').style.display = 'none';
        selecter.selectedIndex = 0;
         document.getElementById('inpSelecter').value = "";
         }
       });
    
          
          const num = document.createElement('h1');
          num.textContent = ben.id;
          num.style.backgroundColor = tocolor(ben.status);
          line.append(num);
          const status = document.createElement('p');
          status.textContent = toread(ben.status);
          status.style.backgroundColor = tocolor(ben.status);
          line.append(status);
          const notes = document.createElement('p');
          notes.textContent = short(ben.notes);
          line.append(notes);
          const pds = document.createElement('p');
          pds.textContent = `${ben.volume} T`;
          line.append(pds);
          bennesContainer.append(line);
        }
      }

      async function filter (what, filtre) {
        console.log("Appel d'un filtre");
        console.log("Avant :", what);
        const query = filtre.toLowerCase();
        return what.filter(obj => Object.values(obj).some(val => String(val).toLowerCase().startsWith(query)));
      }

      function short(str) {
        if (str.length > 50) {
      return str.slice(0, 50) + "...";    
        } else {
      return str;
        }
      }

      function tocolor(statut) {
        if (statut == "A") {
          return 'yellow';
        }
         if (statut == "B") {
          return 'red';
        }
         if (statut == "C") {
          return 'blue';
        }
      }
      function toread(statut) {
        if (statut == "A") {
          return 'posée';
        }
         if (statut == "B") {
          return 'prête';
        }
         if (statut == "C") {
          return 'en dépôt';
        }
      }
      function toreadOpt(statut) {
        if (statut == "volume") {
          return 'Capacité (T)';
        }
         if (statut == "notes") {
          return 'Indications';
        }
         if (statut == "latitude") {
          return 'Latitude';
        }
           if (statut == "longitude") {
          return 'Longitude';
        }
           if (statut == "status") {
          return 'État';
        }
      }

 let numon;
      document.getElementById('createBenne').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = await Object.fromEntries(formData.entries());
        const content = {
          num:data.num,
          volume:data.volume
        };
        const fromServer = await fetcher('createbenne', content, 'POST', sessionStorage.getItem('session_id'));
        showToast(`Création de la benne n°${data.num} !`);
        putBennes('no');
        document.getElementById('createBenne').reset();
      });

      async function deleteBenne(num) {
        if (confirm("Supprimer la benne n°", numon, " ?")) {
          if(confirm("Confirmez pour la dernière fois... Cette action est irréversible")) {
        const content = {
          num:num
        };
        const fromServer = await fetcher('deletebenne', content, 'POST', sessionStorage.getItem('session_id'));
            showToast(`Suppression effective (Benne n°${numon}) !`);
        putBennes('no');
          }}
      }

const benDatas = {};
      
      const selecter = document.getElementById('modifierSelecter');
        const selecterInput = [
        "volume",
        "notes",
        "latitude",
        "longitude",
        "status"
        ];
        const option = document.createElement('option');
          option.value = "no";
          option.text = "Sélectionnez un paramètre";
          option.disabled = true;
          selecter.append(option);
        for (const item of selecterInput) {
          const option = document.createElement('option');
          option.value = item;
          option.text = toreadOpt(item);
          selecter.append(option);
        }
        selecter.addEventListener('change', (event) => {
          console.log(benDatas);
          const value = event.target.value;
          document.getElementById('inpSelecter').value = benDatas[numon][value];
        });
    </script>
    <script>
      async function checkWebSocket() {
        if (!socket || socket.readyState == WebSocket.CLOSED ||  socket.readyState == WebSocket.CLOSING) {
          console.log("WebSocket Inactif !");
          window.location.reload();
        } else {
          console.log("WebSocket Actif !");
        }
      }
      setInterval(checkWebSocket, 15*1000);

      async function resizeMap () {
        document.getElementById('panel').style.display = "flex";
        document.getElementById('panel').style.display = "none";
      }
      resizeMap();

      async function logModification () {
        const parameterToChange = selecter.value;
        const affSelecter = selecter.options[selecter.selectedIndex].text;
        console.log("affSelecter :", affSelecter);
        const value = document.getElementById('inpSelecter').value;
        const num = numon;
        const content = {
          toupd : parameterToChange,
          value_toupd : value,
          eq:'num',
          value_eq:num
        };
        console.log(content);
        const fromServer = await fetcher('editbenne', content, 'POST', sessionStorage.getItem('session_id'));
        setTimeout(() => {
        document.getElementById(`B${numon}`).click();
        }, 500);
        showToast(`Modification enregistrée (Benne n°${numon} - ${affSelecter}) !`);
        document.getElementById('editeurLightBenne').style.display = 'none';
        selecter.selectedIndex = 0;
        document.getElementById('inpSelecter').value = "";
        document.getElementById('filtrerBennes').click();
      }
    </script>
    <style>
      #toast-container {
        position:fixed;
        bottom:2vh;
        right:2vw;
        z-index:9999;
        display:flex;
        flex-direction:column;
        gap:1vh;
      }
      .toast {
        background-color:#4CAF50;
        color:white;
        padding: 1rem 1.5rem;
        border-radius:5px;
        font-size:1rem;
        box-shadow: 0 0 10px;
        animation:fadein 0.5s, fadeout 0.5s 14.5s;
        opacity:0;
        animation-fill-mode:forwards;
      }
      @keyframes fadein {
        from {opacity:0; transform:translateX(50%);}
        to {opacity:1; transform:translateX(0);}
      }
      @keyframes fadeout {
        from {opacity:1; transform:translateX(0);}
        to {opacity:0; transform:translateX(50%);}
      }
    </style>
    <script>
      function showToast(message, color = '#4CAF50') {
        const toast = document.createElement('div');
        toast.classList.add('toast');
        toast.textContent = message;
        toast.style.backgroundColor = color;
        document.getElementById('toast-container').append(toast);
        setTimeout(() => {
          toast.remove();
        }, 15000)
      }

      async function popAdresse (latitude, longitude) {
        const adresse = await fetch(`https://fleuread.onrender.com/osm?coords=${ben.latitude},${ben.longitude}`);
        document.getElementById('lightPB2').textContent = await adresse.json;
      }
    </script>
  </body>
</html>
